Get-WmiObject Win32_diskdrive | Where-Object {$_.interfacetype -eq "USB"} | ForEach-Object {Get-WmiObject -Query "ASSOCIATORS OF {Win32_DiskDrive.DeviceID= `"$ ($_.DeviceID.replace ('\\','\\\\')) `"} WHERE AssocClass = Win32_DiskDriveToDiskPartition"} | ForEach-Object {Get-WmiObject -Query "ASSOCIATORS OF {Win32_DiskPartition.DeviceID= `"$ ($_.DeviceID) `"} WHERE AssocClass = Win32_LogicalDiskToPartition"} | ForEach-Object {$_.deviceid}